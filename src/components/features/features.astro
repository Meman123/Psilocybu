---
// src/components/Features.astro
import { Image } from 'astro:assets';
import growkitImage from '@/assets/growkit-psilocybu.png';

const apiUrl = import.meta.env.PUBLIC_STOCK_API_URL;
---

<style>
/* â€” Bloque principal */
.features{
  background: white;
  padding-block:var(--spacing-xl);
  
}
/* â€” Grid */
.features__container{
  max-width:var(--site-max-width);
  margin-inline:auto;
  padding-inline:var(--side-gutter);
  display:grid;
  gap:var(--spacing-xl);
  grid-template-columns:1fr;
}
/* â€” Columnas */
.features__text{
  display:flex;
  flex-direction:column;
  gap:var(--spacing-lg);
  text-align:left;
}
.features__product{
  --product-col-width:300px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:var(--spacing-lg);
}
/* â€” TipografÃ­a y lista */
.headline{
  font:clamp(2rem,4vw,3rem)/1.1 var(--font-family-headings,'Quicksand');
  font-weight:700;
}
.headline .highlight{
  color: #fffc55;
  text-shadow: 0 2px 2px rgba(0,0,0,0.25), 0 0 4px #222;
  padding: 2px 4px;
  font-weight: 800;
}
.features-list{
  list-style:none;
  padding:0;
  display:flex;
  flex-direction:column;
  gap:16px;
  margin-inline:0;
  align-items:flex-start;
}
.feature-item{
  display:flex;
  align-items:center;
  gap:12px;
  font-weight:500;
  font-size:1rem;
  padding: 8px 12px;
  border-radius: 8px;
  background-color: rgba(255, 252, 85, 0.08);
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  width: 100%;
}
.feature-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
.feature-item::before{
  content:"âœ“";
  flex-shrink:0;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: var(--color-accent);
  color: #83812c;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
/* â€” Badge */
.badge{
  display:inline-block;
  background: linear-gradient(135deg, var(--color-accent), var(--color-accent) 60%, #fffdb0);
  color:#000;
  font-weight:700;
  padding: 8px 16px;
  border-radius: 12px;
  font-size: 1rem;
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  animation: pulse 2s infinite;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.03); }
  100% { transform: scale(1); }
}
/* â€” Imagen */
.product-img{
  width:100%;
  max-width:var(--product-col-width);
}
.product-img :global(img){
  display:block;
  width:100%;
  height:auto;
}
/* â€” Botones */
.cta-buttons{
  display:flex;
  flex-direction:column;
  gap:8px;
  width:100%;
}
.btn{
  flex:1;
  padding-block:12px;
  border-radius:12px;
  font:600 1rem/1 var(--font-family-headings,'Quicksand');
  display:flex;
  justify-content:center;
  align-items:center;
  box-shadow:0 3px 6px rgb(0 0 0/.5);
  transition:transform .25s ease;
  text-align:center;
}
.btn:hover{transform:scale(1.05);}
.btn:focus-visible{
  outline:3px solid var(--color-accent);
  outline-offset:3px;
}
.btn-primary{
  background:var(--color-accent);
  color:#000;
}
.btn-secondary{
  background:#fff;
  color:#000;
}
/* â€” Responsive */
@media (min-width:900px){
  .features__container{
    grid-template-columns:1.5fr 1fr;
    align-items:center;
    gap: var(--spacing-xl);
  }
  .features__text{text-align:left;}
  .cta-buttons{flex-direction:row; }
  .features-list{
    margin-inline:0;
    align-items:flex-start;
    display:grid;
    grid-template-columns:1fr 1fr; /* dos columnas de bullets */
    gap:16px 24px;
  }
  .feature-item {
    font-size: 0.95rem;
  }
}
/* Media query especÃ­fico para tablets */
@media (min-width:768px) and (max-width:899px){
  .features__text {
    text-align: center;
    align-items: center;
  }
  .features-list{
    display:grid;
    grid-template-columns:1fr 1fr; /* dos columnas de bullets en tablet */
    gap:16px 20px;
    width: 100%;
    max-width: 600px;
  }
  .headline {
    text-align: center;
    width: 100%;
  }
  .cta-buttons{flex-direction:row; }
  .feature-item {
    justify-content: center;
    text-align: center;
    padding-left: 40px;
    padding-right: 40px;
    position: relative;
  }
  .feature-item::before {
    position: absolute;
    left: 12px;
  }
}
@media (max-width:767px){
  .features__text {
    text-align: center;
    align-items: center;
  }
  .headline {
    text-align: center;
    width: 100%;
  }
  .features-list{
    display:flex;
    flex-direction:column; /* una columna de bullets en mÃ³vil */
    width: 100%;
    margin: 0 auto;
  }
  .feature-item {
    width: 100%;
    justify-content: center;
    text-align: center;
    padding-left: 40px;
    padding-right: 40px;
    position: relative;
  }
  .feature-item::before {
    position: absolute;
    left: 12px;
  }
}
@media (max-width:500px){
  .feature-item{font-size:1.05rem;}
}
.stock-counter {
  margin-top: 4px;
  font-size: 1rem;
  font-weight: 600;
  color: #333;
  padding: 8px 12px;
  border-radius: 10px;
  background: #fff8cd;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
  min-height: 24px;
  transition: background 0.3s;
  text-align: center;
}
.stock-counter.agotado {
  background: #ffe5e5;
  color: #b80000;
}
</style>

<section class="features" id="features">
  <div class="features__container">
    <div class="features__text">
      <h2 class="headline">
        Â¡Cosecha tus honguitos en solo <span class="highlight">2&nbsp;semanas!</span>
      </h2>
      <ul class="features-list">
        <li class="feature-item"><strong>Micelio Fresco de Calidad:</strong> Recibe 1 litro de micelio de la variedad Villa de Leyva, conocida por su resistencia y rÃ¡pido crecimiento, ideal para iniciar tu cultivo de hongos en casa.</li>
        <li class="feature-item"><strong>Bolsa de Cultivo Profesional:</strong> Nuestro kit de cultivo incluye una bolsa #bagtek estÃ©ril de alta calidad que crea el ambiente perfecto para la fructificaciÃ³n de tus hongos.</li>
        <li class="feature-item"><strong>Cosecha RÃ¡pida en Colombia:</strong> Â¡Observa los primeros resultados en solo 2 semanas! Nuestro kit estÃ¡ optimizado para que obtengas tu cosecha de hongos frescos rÃ¡pidamente.</li>
        <li class="feature-item"><strong>Todo Incluido para Empezar:</strong> El kit viene con atomizador, clip de cierre e instructivo detallado. Todo lo que necesitas para tu cultivo de hongos en Colombia.</li>
        <li class="feature-item"><strong>Ideal para Principiantes:</strong> No necesitas experiencia previa ni equipos sofisticados. Es el kit de cultivo de hongos perfecto para dar tus primeros pasos en la micologÃ­a desde casa.</li>
        <li class="feature-item"><strong>Bajo Mantenimiento:</strong> Dedica solo 5 minutos de atenciÃ³n cada 7 dÃ­as. Nuestro mÃ©todo simplifica el proceso para que disfrutes del cultivo sin complicaciones.</li>
        <li class="feature-item"><strong>Soporte en Colombia:</strong> Ofrecemos soporte experto y personalizado para resolver todas tus dudas durante el proceso de cultivo de tu kit.</li>
        <li class="feature-item"><strong>EnvÃ­o Gratis a toda Colombia:</strong> Recibe tu kit de cultivo de hongos en cualquier lugar de Colombia sin costo adicional. Â¡Tu aventura micolÃ³gica empieza aquÃ­!</li>
      </ul>
    </div>
    <div class="features__product">
      <div class="badge badge-shipping">ðŸšš EnvÃ­o gratis nacional</div>
      <div class="product-img">
        <Image
          src={growkitImage}
          alt="Growkit de Psilocybu con hongos Villa de Leyva"
          width={400}
          height={400}
          sizes="(min-width:900px) 320px, 80vw"
          format="webp"
          quality={90}
        />
      </div>
      <div class="cta-buttons">
        <a href="/growkit" class="btn btn-primary" id="buy-btn">Compra tu GrowKit</a>
        <a href="#tutorials" class="btn btn-secondary">Â¿CÃ³mo funciona?</a>
      </div>
      <div class="stock-counter" id="stock-counter">
        Consultando disponibilidad...
      </div>
    </div>
  </div>

  <script type="module" define:vars={{ apiUrl }}>
    async function updateStock() {
      const counter = document.getElementById('stock-counter');
      const buyBtn = document.getElementById('buy-btn');
      try {
        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error();
        const data = await res.json();
        if (data.stock > 0) {
          counter.textContent = `Disponibles: ${data.stock}`;
          counter.classList.remove('agotado');
          buyBtn.removeAttribute('disabled');
          buyBtn.textContent = "Compra tu GrowKit";
        } else {
          counter.textContent = "Â¡Agotado!";
          counter.classList.add('agotado');
          buyBtn.setAttribute('disabled', true);
          buyBtn.textContent = "Agotado";
        }
      } catch (e) {
        counter.textContent = 'No disponible. Intenta mÃ¡s tarde.';
        counter.classList.add('agotado');
        buyBtn.setAttribute('disabled', true);
        buyBtn.textContent = "Sin stock";
      }
    }
    updateStock();
  </script>
</section>
